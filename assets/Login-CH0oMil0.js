import{_ as C,e as p,f as B,c as g,g as h,w as a,a as l,b as f,h as E,s as I,i as N,E as R,r as s,o as r,d as T,j as x,u as j}from"./index-DDNoP6j1.js";const L={class:"login-container"},z={key:1,class:"loading-container"},m="Iv23li6mS71Nl5c3wBwB",U={__name:"Login",setup(V){const k=window.location.origin+"/login",w=j(),u=E(),c=p(!1),d=p(""),y=()=>{const o=`https://github.com/login/oauth/authorize?client_id=${m}&redirect_uri=${k}&scope=repo`;window.location.href=o},v=async o=>{try{c.value=!0;const t=await(await fetch("https://github-oa.xuqinyang.us.kg/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({client_id:m,code:o})})).json();if(t.access_token){I(t.access_token);const n=await(await fetch("https://api.github.com/user",{headers:{Authorization:`token ${t.access_token}`}})).json();N({id:n.id,login:n.login,avatar_url:n.avatar_url});const i=u.query.redirect||"/";w.push(i).then(()=>{location.reload()})}else throw new Error("Failed to get access token")}catch(e){console.error("Login failed:",e),R.error("登录失败，请重试")}finally{c.value=!1}};return B(()=>{const o=u.query.code;o&&(d.value=o,v(o))}),(o,e)=>{const t=s("i-ep-position"),_=s("el-icon"),n=s("el-button"),i=s("el-card"),b=s("el-spinner");return r(),g("div",L,[c.value?(r(),g("div",z,[l(b,{size:"large"}),e[2]||(e[2]=f("p",null,"正在登录中...",-1))])):(r(),h(i,{key:0,class:"login-card"},{header:a(()=>e[0]||(e[0]=[f("h2",null,"登录 GitHub",-1)])),default:a(()=>[d.value?x("",!0):(r(),h(n,{key:0,type:"primary",onClick:y,size:"large"},{default:a(()=>[l(_,null,{default:a(()=>[l(t)]),_:1}),e[1]||(e[1]=T(" 使用 GitHub 账号登录 "))]),_:1}))]),_:1}))])}}},D=C(U,[["__scopeId","data-v-1eb5cc66"]]);export{D as default};
