import{_ as C,e as _,f as R,c as p,g,w as a,a as l,b as h,s as B,h as E,E as I,r as s,o as r,d as N,i as T,u as x,j as L}from"./index-BCFhymPB.js";const j={class:"login-container"},U={key:1,class:"loading-container"},m="Iv23li6mS71Nl5c3wBwB",z={__name:"Login",setup(P){const f=window.location.origin+"/#/login",w=x(),k=L(),i=_(!1),u=_(""),y=()=>{const o=`https://github.com/login/oauth/authorize?client_id=${m}&redirect_uri=${f}`;window.location.href=o},v=async o=>{try{i.value=!0;const t=await(await fetch("https://github-oa.xuqinyang.us.kg/",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({client_id:m,code:o})})).json();if(t.access_token){B(t.access_token);const n=await(await fetch("https://api.github.com/user",{headers:{Authorization:`token ${t.access_token}`}})).json();E({id:n.id,login:n.login,avatar_url:n.avatar_url});const c=k.query.redirect||"/";w.push(c).then(()=>{location.reload()})}else throw new Error("Failed to get access token")}catch(e){console.error("Login failed:",e),I.error("登录失败，请重试")}finally{i.value=!1}};return R(()=>{const e=new URLSearchParams(window.location.search).get("code");e&&(u.value=e,v(e))}),(o,e)=>{const t=s("i-ep-position"),d=s("el-icon"),n=s("el-button"),c=s("el-card"),b=s("el-spinner");return r(),p("div",j,[i.value?(r(),p("div",U,[l(b,{size:"large"}),e[2]||(e[2]=h("p",null,"正在登录中...",-1))])):(r(),g(c,{key:0,class:"login-card"},{header:a(()=>e[0]||(e[0]=[h("h2",null,"登录 GitHub",-1)])),default:a(()=>[u.value?T("",!0):(r(),g(n,{key:0,type:"primary",onClick:y,size:"large"},{default:a(()=>[l(d,null,{default:a(()=>[l(t)]),_:1}),e[1]||(e[1]=N(" 使用 GitHub 账号登录 "))]),_:1}))]),_:1}))])}}},V=C(z,[["__scopeId","data-v-a084f148"]]);export{V as default};
