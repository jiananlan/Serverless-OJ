import{_ as P,e as d,f as L,E as v,c as w,a,w as n,j as T,r as l,o as E,b as p,t as m,i as O,d as j,u as H,l as K}from"./index-BI48E65Q.js";import{m as D}from"./github-markdown-BOpQ1pHb.js";import{a as _}from"./axios-DXsv3KKR.js";const G={class:"submit"},Y={class:"header"},q={key:0,class:"problem-info"},z=["innerHTML"],A="https://api.github.com",k="xqy2006",C="Serverless-OJ",F={__name:"Submit",setup(J){const y=T(),R=H(),r=d(null),h=d(""),u=d({language:"cpp",code:""}),g=d(!1);L(async()=>{try{const t=await _.get(`/problems/${y.params.id}/problem.json`);r.value=t.data;const e=await _.get(`/problems/${y.params.id}/README.md`);h.value=D(e.data)}catch(t){console.error("Failed to load problem:",t),v.error("加载题目失败")}});async function S(t){const o=await(await fetch("/public_key.pem")).text(),c=await crypto.subtle.importKey("spki",x(o),{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),f=new TextEncoder().encode(t),b=await crypto.subtle.encrypt({name:"RSA-OAEP"},c,f);return btoa(String.fromCharCode(...new Uint8Array(b)))}function x(t){const e=t.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,""),o=atob(e),c=new Uint8Array(o.length);for(let s=0;s<o.length;s++)c[s]=o.charCodeAt(s);return c.buffer}async function V(t,e){const o=localStorage.getItem("github_token");if(!o)throw new Error("No GitHub token found");return(await _.post(`${A}/repos/${k}/${C}/issues`,{title:t,body:e},{headers:{Authorization:`token ${o}`,Accept:"application/vnd.github.v3+json"}})).data}async function B(){return(await _.get(`${A}/repos/${k}/${C}/issues`,{params:{state:"all"},headers:{Accept:"application/vnd.github.v3+json"}})).data}const I=async()=>{g.value=!0;try{var t=await S(K().login+`
`+u.value.code);await V(r.value.title+"评测",t);var e=await B();console.log(e),v.success("提交成功"),setTimeout(()=>{R.push("/status")},3e3)}catch{v.error("提交失败")}};return(t,e)=>{const o=l("el-option"),c=l("el-select"),s=l("el-form-item"),f=l("el-input"),b=l("el-button"),M=l("el-form"),N=l("el-card"),U=l("el-col"),$=l("el-row");return E(),w("div",G,[a($,{justify:"center"},{default:n(()=>[a(U,{span:20},{default:n(()=>[a(N,null,{header:n(()=>{var i;return[p("div",Y,[p("h2",null,m((i=r.value)==null?void 0:i.title),1)])]}),default:n(()=>[r.value?(E(),w("div",q,[p("h5",null,"供题人："+m(r.value.author),1),p("h5",null,"内存限制："+m(r.value.memoryLimit)+" MB，时间限制："+m(r.value.timeLimit)+" ms",1),p("div",{class:"markdown-body",innerHTML:h.value},null,8,z)])):O("",!0),a(M,{model:u.value,class:"submit-form"},{default:n(()=>[a(s,{label:"编程语言"},{default:n(()=>[a(c,{modelValue:u.value.language,"onUpdate:modelValue":e[0]||(e[0]=i=>u.value.language=i),placeholder:"选择编程语言"},{default:n(()=>[a(o,{label:"C++",value:"cpp"})]),_:1},8,["modelValue"])]),_:1}),a(s,{label:"代码"},{default:n(()=>[a(f,{modelValue:u.value.code,"onUpdate:modelValue":e[1]||(e[1]=i=>u.value.code=i),type:"textarea",rows:15,placeholder:"在此输入你的代码"},null,8,["modelValue"])]),_:1}),a(s,null,{default:n(()=>[a(b,{type:"primary",disabled:g.value,onClick:I},{default:n(()=>e[2]||(e[2]=[j(" 提交代码 ")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}},Z=P(F,[["__scopeId","data-v-63b8f959"]]);export{Z as default};
