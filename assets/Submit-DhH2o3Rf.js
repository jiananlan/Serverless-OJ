import{_ as O,e as d,f as P,E as h,c as w,a,w as s,h as L,r,o as E,b as p,t as m,j as T,d as j,u as H,l as K}from"./index-DDNoP6j1.js";import{m as q}from"./github-markdown-BOpQ1pHb.js";import{a as _}from"./axios-DXsv3KKR.js";const D={class:"submit"},G={class:"header"},J={key:0,class:"problem-info"},Y=["innerHTML"],A="https://api.github.com",k="xqy2006",S="Serverless-OJ",z={__name:"Submit",setup(F){const v=L(),x=H(),l=d(null),y=d(""),u=d({language:"cpp",code:""}),g=d(!1);P(async()=>{try{const t=await _.get(`https://xqy2006.github.io/Serverless-OJ/problems/${v.params.id}/problem.json`);l.value=t.data;const e=await _.get(`https://xqy2006.github.io/Serverless-OJ/problems/${v.params.id}/README.md`);y.value=q(e.data)}catch(t){console.error("Failed to load problem:",t),h.error("加载题目失败")}});async function C(t){const o=await(await fetch("/public_key.pem")).text(),c=await crypto.subtle.importKey("spki",R(o),{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),b=new TextEncoder().encode(t),f=await crypto.subtle.encrypt({name:"RSA-OAEP"},c,b);return btoa(String.fromCharCode(...new Uint8Array(f)))}function R(t){const e=t.replace("-----BEGIN PUBLIC KEY-----","").replace("-----END PUBLIC KEY-----","").replace(/\s/g,""),o=atob(e),c=new Uint8Array(o.length);for(let n=0;n<o.length;n++)c[n]=o.charCodeAt(n);return c.buffer}async function V(t,e){const o=localStorage.getItem("github_token");if(!o)throw new Error("No GitHub token found");return(await _.post(`${A}/repos/${k}/${S}/issues`,{title:t,body:e},{headers:{Authorization:`token ${o}`,Accept:"application/vnd.github.v3+json"}})).data}async function B(){return(await _.get(`${A}/repos/${k}/${S}/issues`,{params:{state:"all"},headers:{Accept:"application/vnd.github.v3+json"}})).data}const I=async()=>{g.value=!0;try{var t=await C(K().login+`
`+u.value.code);await V(l.value.title+"评测",t);var e=await B();console.log(e),h.success("提交成功"),setTimeout(()=>{x.push("/status")},3e3)}catch{h.error("提交失败")}};return(t,e)=>{const o=r("el-option"),c=r("el-select"),n=r("el-form-item"),b=r("el-input"),f=r("el-button"),M=r("el-form"),N=r("el-card"),U=r("el-col"),$=r("el-row");return E(),w("div",D,[a($,{justify:"center"},{default:s(()=>[a(U,{span:20},{default:s(()=>[a(N,null,{header:s(()=>{var i;return[p("div",G,[p("h2",null,m((i=l.value)==null?void 0:i.title),1)])]}),default:s(()=>[l.value?(E(),w("div",J,[p("h5",null,"供题人："+m(l.value.author),1),p("h5",null,"内存限制："+m(l.value.memoryLimit)+" MB，时间限制："+m(l.value.timeLimit)+" ms",1),p("div",{class:"markdown-body",innerHTML:y.value},null,8,Y)])):T("",!0),a(M,{model:u.value,class:"submit-form"},{default:s(()=>[a(n,{label:"编程语言"},{default:s(()=>[a(c,{modelValue:u.value.language,"onUpdate:modelValue":e[0]||(e[0]=i=>u.value.language=i),placeholder:"选择编程语言"},{default:s(()=>[a(o,{label:"C++",value:"cpp"})]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"代码"},{default:s(()=>[a(b,{modelValue:u.value.code,"onUpdate:modelValue":e[1]||(e[1]=i=>u.value.code=i),type:"textarea",rows:15,placeholder:"在此输入你的代码"},null,8,["modelValue"])]),_:1}),a(n,null,{default:s(()=>[a(f,{type:"primary",disabled:g.value,onClick:I},{default:s(()=>e[2]||(e[2]=[j(" 提交代码 ")])),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})])}}},Z=O(z,[["__scopeId","data-v-5e3eedbd"]]);export{Z as default};
